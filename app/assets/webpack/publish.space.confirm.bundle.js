webpackJsonp([71],{1505:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(19),n=r(23),l=r(133),i=r(2),u=r(2203),o=function(e){return e&&e.__esModule?e:{default:e}}(u),c=r(331),d=r(213),f=r(1792),s=i.publishSpaceRouter.confirmPath,p=i.items.servicePath,m=function(e){var t=e.environment,r=e.routingHelper,a=e[c.REDUCER_KEY],n=e[d.REDUCER_KEY];return{environment:t,routingHelper:r,publish:a,covers:n,categories:e.categories[l.CATEGORY_SPACE],isValid:(0,f.validateAllBy)(a,n)}},v=function(e,t){var r=t.location.query,a=r.pid;return{dispatchSavePublish:function(){return e(a?(0,c.updatePublish)(a):(0,c.savePublish)())},dispatchValidateAll:function(){return e((0,f.validateAll)())},dispatchTouchPath:function(){return e((0,c.touchPath)(s(a)))},redirectToItems:function(){return n.browserHistory.push(p)}}};t.default=(0,a.connect)(m,v)(o.default)},1552:function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.STATUS_VALID=t.STATUS_LOADING=t.STATUS_DISABLE=void 0;var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),c=r(0),d=a(c),f=r(3),s=a(f),p=r(519),m=a(p),v=r(14),y=a(v),h=r(5),E=a(h),b=r(1557),_=a(b),g=t.STATUS_DISABLE="STATUS_DISABLE",C=t.STATUS_LOADING="STATUS_LOADING",P=t.STATUS_VALID="STATUS_VALID",T=y.default.bind(_.default),A=function(e){function t(e){l(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.state={status:null},r.onClickNext=r.onClickNext.bind(r),r}return u(t,e),o(t,null,[{key:"renderDisable",value:function(e){var t=e.onClick,r=e.text;return d.default.createElement("button",{className:"button "+T("button","disabled"),onClick:t},r)}},{key:"renderLoading",value:function(){var e=d.default.createElement("div",{styleName:"loading-icon"},d.default.createElement(m.default,{size:9,color:"#B8B8B8"}));return d.default.createElement("button",{className:"button "+T("button","disabled")},e,"儲存中")}},{key:"renderValid",value:function(e){var t=e.onClick,r=e.text;return d.default.createElement("button",{className:"button "+T("button","active"),onClick:t},r)}}]),o(t,[{key:"onClickNext",value:function(){var e=this.props,t=e.onClick,r=e.status,a=t;this.setState({status:r===P?C:null},a)}},{key:"render",value:function(){var e,t=this.constructor,r=t.renderDisable,a=t.renderLoading,l=t.renderValid,i=this.props.text;return(e={},n(e,g,r({onClick:this.onClickNext,text:i})),n(e,C,a()),n(e,P,l({onClick:this.onClickNext,text:i})),e)[this.state.status||this.props.status]}}]),t}(d.default.Component);A.defaultProps={text:"下一步",status:g},A.propTypes={text:s.default.string.isRequired,status:s.default.oneOf([g,C,P]),onClick:s.default.func.isRequired},t.default=(0,E.default)(A,_.default)},1553:function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),o=r(0),c=a(o),d=r(3),f=a(d),s=r(11),p=a(s),m=r(5),v=a(m),y=r(1558),h=a(y),E=function(e){function t(){return n(this,t),l(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),u(t,[{key:"render",value:function(){var e=this.props,t=e.title,r=e.helperText,a=e.optional,n=e.children;return c.default.createElement("div",{styleName:"container"},c.default.createElement("div",{styleName:"title-container"},c.default.createElement("h2",{styleName:"title"},t,a&&c.default.createElement("span",{styleName:"titleHelper"},"（非必填）")),r&&c.default.createElement("span",{styleName:"helper"},r)),n)}}]),t}(c.default.Component);E.defaultProps={helperText:null,optional:!1},E.propTypes={children:p.default.children.isRequired,title:f.default.string.isRequired,helperText:f.default.string,optional:f.default.bool},t.default=(0,v.default)(E,h.default)},1557:function(e,t){e.exports={button:"NextStep_button_e8To5",active:"NextStep_active_2uSyl",disabled:"NextStep_disabled_dCatW","loading-icon":"NextStep_loading-icon_1tLMz"}},1558:function(e,t){e.exports={container:"FormContainer_container_2PVcv","title-container":"FormContainer_title-container_2qfVb",title:"FormContainer_title_1cLV5",titleHelper:"FormContainer_titleHelper_1Diqs",helper:"FormContainer_helper_1uffx"}},1630:function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),l=a(n),i=r(3),u=a(i),o=r(5),c=a(o),d=r(1690),f=a(d),s={title:u.default.string.isRequired,children:u.default.node.isRequired},p=function(e){return l.default.createElement("div",{styleName:"container"},l.default.createElement("div",{styleName:"title"},e.title),e.children)};p.propTypes=s,t.default=(0,c.default)(p,f.default)},1690:function(e,t){e.exports={container:"ConfirmTitle_container_3R7RZ",title:"ConfirmTitle_title_2ngQB"}},1792:function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.validateAll=t.validateAllBy=t.validateCancelPolicy=t.validateCancelPolicyBy=t.validateRegulation=t.validateRegulationBy=t.validatePrice=t.validatePriceBy=t.validateAbout=t.validateAboutBy=t.validateCovers=t.validateCoversBy=void 0;var n=r(201),l=a(n),i=r(85),u=a(i),o=r(154),c=a(o),d=r(132),f=r(323),s=a(f),p=r(331),m=r(213),v=t.validateCoversBy=function(e){var t=(0,l.default)(e,{isStored:!0}).length;return{isValid:t>0,errors:[e.length,t]}},y=t.validateCovers=function(){return function(e,t){return new Promise(function(e,r){var a=t()[m.REDUCER_KEY],n=v(a),l=n.isValid,i=n.errors;l?e():r(i)})}},h=t.validateAboutBy=function(e){var t=e.title,r=e.descript,a=e.cityName,n=e.areaName,l=e.assignAddress,i=e.categoryID,o=e.tag1,d=e.tag2,f=e.tag3,p=(0,c.default)({title:t,descript:r,cityArea:""+a+n,assignAddress:l,category:i,tag1:o,tag2:d,tag3:f},{title:s.default.title,descript:s.default.descript,cityArea:s.default.cityArea,assignAddress:s.default.address,category:s.default.category,tag1:s.default.tag,tag2:s.default.tag,tag3:s.default.tag});return{isValid:(0,u.default)(p),errors:p}},E=t.validateAbout=function(){return function(e,t){return new Promise(function(e,r){var a=t()[p.REDUCER_KEY],n=a.title,l=a.descript,i=a.cityName,u=a.areaName,o=a.assignAddress,c=a.categoryID,d=a.tag1,f=a.tag2,s=a.tag3,m=h({title:n,descript:l,cityName:i,areaName:u,assignAddress:o,categoryID:c,tag1:d,tag2:f,tag3:s}),v=m.isValid,y=m.errors;v?e():r(y)})}},b=t.validatePriceBy=function(e){var t=e.chargeType,r=e.price,a=e.deposit,n=e.reservationDays,l=e.discounts;if(!t)return{isValid:!1,errors:{chargeTypeError:"請選擇一種計費方式"}};var i=parseInt(r,10)||0,o=parseInt(a,10)||0;if(i+o>f.PRICE_MAX)return{isValid:!1,errors:{totalError:"總計不得超過 "+(0,d.formatCurrency)(f.PRICE_MAX)}};var p=(0,c.default)({price:r,deposit:a,reservationDays:n},{price:s.default.price,deposit:s.default.deposit,reservationDays:s.default.serviceReservationDays});return p||l.forEach(function(e){var t=e.param,r=e.discount,a=(0,c.default)({param:t,val:r},{param:s.default.discountParam,val:s.default.discountVal(i)});(0,u.default)(p)&&(p=a)}),{isValid:(0,u.default)(p),errors:p}},_=t.validatePrice=function(){return function(e,t){return new Promise(function(e,r){var a=t()[p.REDUCER_KEY],n=b(a),l=n.isValid,i=n.errors;l?e():r(i)})}},g=t.validateRegulationBy=function(e){var t=e.regulation,r=(0,c.default)({regulation:t},{regulation:s.default.regulation});return{isValid:(0,u.default)(r),errors:r}},C=t.validateRegulation=function(){return function(e,t){return new Promise(function(e,r){var a=t()[p.REDUCER_KEY],n=g(a),l=n.isValid,i=n.errors;l?e():r(i)})}},P=t.validateCancelPolicyBy=function(e){var t=e.hasCancelPolicy,r=e.advanceDay,a=e.rate;if(!t)return{isValid:!0};var n=(0,c.default)({advanceDay:r,rate:a},{advanceDay:s.default.advanceDay,rate:s.default.rate});return{isValid:(0,u.default)(n),errors:n}},T=t.validateCancelPolicy=function(){return function(e,t){return new Promise(function(e,r){var a=t()[p.REDUCER_KEY],n=P(a),l=n.isValid,i=n.errors;l?e():r(i)})}};t.validateAllBy=function(e,t){var r=v(t),a=r.isValid,n=h(e),l=n.isValid,i=b(e),u=i.isValid,o=g(e),c=o.isValid,d=P(e),f=d.isValid;return a&&l&&u&&c&&f},t.validateAll=function(){return function(e){return new Promise(function(t,r){var a=[e(y()),e(E()),e(_()),e(C()),e(T())];Promise.all(a).then(function(e){return t(e)}).catch(function(e){return r(e)})})}}},2203:function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),c=r(0),d=a(c),f=r(3),s=a(f),p=r(11),m=a(p),v=r(108),y=a(v),h=r(1553),E=a(h),b=r(1630),_=a(b),g=r(1552),C=a(g),P=r(523),T=r(132),A=r(538),S=r(14),N=a(S),R=r(517),w=r(5),k=a(w),D=r(2319),O=a(D),x=N.default.bind(O.default),V=function(e){function t(e){l(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.onNextStepClick=r.onNextStepClick.bind(r),r}return u(t,e),o(t,null,[{key:"renderCovers",value:function(e){return d.default.createElement("div",{className:x("covers-container")},e.map(function(e,t){return d.default.createElement("div",{key:""+(t+1),className:x("photo")},d.default.createElement(y.default,{src:e.s3}),0===t&&d.default.createElement("div",{className:x("cover-label")},"封面"))}))}}]),o(t,[{key:"componentDidMount",value:function(){this.props.dispatchTouchPath()}},{key:"onNextStepClick",value:function(){var e=this.props,t=e.dispatchSavePublish,r=e.dispatchValidateAll,a=e.redirectToItems,n=e.routingHelper.removeHook;r().then(function(){t().then(function(){n&&n(),a()}).catch(function(e){return console.warn(e)})}).catch(function(e){console.warn(e),alert("尚未填寫完整")})}},{key:"renderDiscount",value:function(){var e=this.props.publish,t=e.discounts,r=e.chargeType;if(t.length<=0)return d.default.createElement("tr",null,d.default.createElement("th",{width:154},"優惠價"),d.default.createElement("td",null,d.default.createElement("div",null,"沒有特價方案")));var a=r===R.CHARGE_TYPE_DAY?"日":"月";return d.default.createElement("tr",null,d.default.createElement("th",{width:154},"優惠價"),d.default.createElement("td",null,t.map(function(e,t){return d.default.createElement("div",{key:""+(t+1)},"租滿",e.param,a,"，每",a,(0,T.formatCurrency)(e.discount))})))}},{key:"render",value:function(){var e,t,r=this.props,a=r.publish,l=r.isValid,i=r.covers,u=r.categories,o=a.title,c=a.descript,f=a.categoryID,s=a.tag1,p=a.tag2,m=a.tag3,v=(0,P.findCategoryNamesByID)(f,u),y=a.cityName,h=a.areaName,b=a.assignAddress,S=a.price,N=a.deposit,w=a.chargeType,k=(a.discount,a.hasCancelPolicy),D=a.advanceDay,O=a.rate,x=a.regulation,V=this.constructor.renderCovers;return d.default.createElement(E.default,{title:"確認發佈"},d.default.createElement(_.default,{title:"物品照片"},V(i)),d.default.createElement(_.default,{title:"關於服務"},d.default.createElement("table",{styleName:"table"},d.default.createElement("tbody",null,d.default.createElement("tr",null,d.default.createElement("th",{width:154},"服務名稱"),d.default.createElement("td",null,o)),d.default.createElement("tr",null,d.default.createElement("th",null,"描述"),d.default.createElement("td",null,(0,A.htmlNewLineToBreak)(c))),d.default.createElement("tr",null,d.default.createElement("th",null,"分類"),d.default.createElement("td",null,v&&""+v.middleName)),d.default.createElement("tr",null,d.default.createElement("th",null,"標籤"),d.default.createElement("td",null,!s&&!p&&!m&&d.default.createElement("div",null,"未設定"),s&&d.default.createElement("div",null,"#",s),p&&d.default.createElement("div",null,"#",p),m&&d.default.createElement("div",null,"#",m)))))),d.default.createElement(_.default,{title:"空間資訊"},d.default.createElement("table",{styleName:"table"},d.default.createElement("tbody",null,d.default.createElement("tr",null,d.default.createElement("th",{width:154},"所在地址"),d.default.createElement("td",null,y,h,b))))),d.default.createElement(_.default,{title:"設定價格"},d.default.createElement("table",{styleName:"table"},d.default.createElement("tbody",null,d.default.createElement("tr",null,d.default.createElement("th",null,"計費方式"),d.default.createElement("td",null,(e={},n(e,R.CHARGE_TYPE_DAY,"以日計費"),n(e,R.CHARGE_TYPE_MONTH,"以月計費"),e)[w])),d.default.createElement("tr",null,d.default.createElement("th",{width:154},"價格"),d.default.createElement("td",null,d.default.createElement("div",null,(t={},n(t,R.CHARGE_TYPE_DAY,"每日"+(0,T.formatCurrency)(S)),n(t,R.CHARGE_TYPE_MONTH,"每月"+(0,T.formatCurrency)(S)),t)[w]))),d.default.createElement("tr",null,d.default.createElement("th",{width:154},"押金"),d.default.createElement("td",null,d.default.createElement("div",null,"每筆交易",(0,T.formatCurrency)(N)))),this.renderDiscount(),k?d.default.createElement("tr",null,d.default.createElement("th",{width:154},"退訂政策"),d.default.createElement("td",null,"開始租借前"+D+"天若取消訂單，則扣除"+O+"%押金")):null))),x&&d.default.createElement(_.default,{title:"分享人守則"},d.default.createElement("div",{styleName:"text-block"},(0,A.htmlNewLineToBreak)(x))),d.default.createElement(C.default,{text:"儲存",status:l?g.STATUS_VALID:g.STATUS_DISABLE,onClick:this.onNextStepClick}))}}]),t}(d.default.Component);V.defaultProps={categories:null},V.propTypes={routingHelper:s.default.shape({removeHook:s.default.func.isRequired}).isRequired,covers:s.default.arrayOf(s.default.object).isRequired,categories:m.default.middleCategories,publish:m.default.publish.isRequired,isValid:s.default.bool.isRequired,dispatchTouchPath:s.default.func.isRequired,dispatchSavePublish:s.default.func.isRequired,dispatchValidateAll:s.default.func.isRequired,redirectToItems:s.default.func.isRequired},t.default=(0,k.default)(V,O.default)},2319:function(e,t){e.exports={container:"StepConfirm_container_C_Gto",table:"StepConfirm_table_aJKcg","text-block":"StepConfirm_text-block_3EoaN","covers-container":"StepConfirm_covers-container_2rXYW",photo:"StepConfirm_photo_3WOu_","cover-label":"StepConfirm_cover-label_eg7jo",hightlight:"StepConfirm_hightlight_2bzZT",categoryArrow:"StepConfirm_categoryArrow_2TWrR"}}});